# 삼국시대 지도 네비게이션 개선 계획

> **작성일**: 2025-12-31  
> **상태**: ✅ 구현 완료

---

## 🎯 문제

- 삼국시대 지도 위 장소 마커들의 위치가 역사적 위치와 맞지 않음
- Spiderfy 로직으로 마커 겹침 처리가 복잡함

---

## ✅ 해결 방안

**왕국 라벨 방식으로 변경**

```
기존: 지도 마커 직접 클릭 → 장소 상세
변경: 왕국 라벨 클릭 → 장소 리스트 → 장소 선택
```

---

## 🎨 새로운 UX 플로우

```
┌─────────────────────────────────────┐
│           삼국시대 지도             │
│                                     │
│         🔴 고구려                   │
│            (3개 장소)               │
│                                     │
│   🟡 백제              🔵 신라      │
│   (3개 장소)           (2개 장소)   │
│                                     │
│              🟢 가야                │
│              (3개 장소)             │
│                                     │
└─────────────────────────────────────┘
              ↓ (왕국 라벨 탭)
┌─────────────────────────────────────┐
│     🔴 고구려 장소 (3)              │
├─────────────────────────────────────┤
│  📍 국내성        광개토대왕        │
│     광개토대왕 시대 고구려의 도읍   │
├─────────────────────────────────────┤
│  📍 살수(청천강)   을지문덕         │
│     살수대첩의 현장                 │
├─────────────────────────────────────┤
│  📍 평양성         장수왕           │
│     고구려 후기 도읍                │
└─────────────────────────────────────┘
              ↓ (장소 탭)
       [장소 탐험 화면 이동]
```

---

## 📁 구현 파일

| 파일 | 설명 | 상태 |
|------|------|------|
| `kingdom_label.dart` | 왕국 라벨 위젯 (탭 가능, 펄스 애니메이션) | ✅ 완료 |
| `kingdom_location_sheet.dart` | 왕국별 장소 바텀시트 | ✅ 완료 |
| `era_exploration_screen.dart` | 삼국시대 조건부 처리 추가 | ✅ 완료 |

---

## 🏰 왕국별 데이터 (위치 최종 수정됨)

| 왕국 | 색상 | 장소 수 | 위치 (지도 비율) |
|------|------|---------|-----------------|
| 🔴 **고구려** | #B22222 | 3개 | 상단 중앙 (0.48, 0.25) |
| 🟡 **백제** | #228B22 | 3개 | 좌측 중앙 (0.36, 0.65) [최종] |
| 🔵 **신라** | #4169E1 | 2개 | 우측 중앙 (0.68, 0.60) |
| 🟢 **가야** | #DAA520 | 3개 | 중앙 하단 (0.60, 0.82) [최종] |

> **수정 사항 (2차)**:
> - 백제: 동쪽 내륙으로 이동 (0.28, 0.62 → 0.36, 0.65)
> - 가야: 동쪽 김해/낙동강 쪽으로 이동 (0.54, 0.80 → 0.60, 0.82)

---

## 🔧 구현 세부사항

### 1. 왕국 라벨 (`KingdomLabel`)

- 펄스 애니메이션 (1.0 → 1.08 반복)
- 왕국별 색상 그라데이션
- 장소 개수 표시
- 탭 시 햅틱 피드백

### 2. 장소 바텀시트 (`KingdomLocationSheet`)

- 왕국 헤더 (아이콘, 이름, 장소 수)
- 장소 리스트 (썸네일, 설명, 캐릭터 아바타)
- 장소 탭 시 LocationExplorationScreen으로 이동

### 3. 조건부 처리 (`EraExplorationScreen`)

```dart
// 삼국시대: 왕국 라벨 방식 / 다른 시대: 마커 방식
if (isThreeKingdoms)
  _buildKingdomLabelsLayer(context, mapSize)
else
  // 기존 마커 레이어
```

---

## ✅ 완료 체크리스트

- [x] 왕국 라벨 위젯 생성
- [x] 장소 리스트 바텀시트 생성
- [x] 메인 화면 조건부 처리
- [x] 빌드 성공 확인

---

*구현 완료일: 2025-12-31*
